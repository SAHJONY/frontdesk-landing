import {headers} from "next/headers"; import {NextResponse} from "next/server"; import Stripe from "stripe"; export const runtime="nodejs"; export const dynamic="force-dynamic"; const stripe=new Stripe(process.env.STRIPE_SECRET_KEY!,{apiVersion:"2025-09-30.clover" as any}); export async function POST(req:Request){const sig=headers().get("stripe-signature") as string|null; const wh=process.env.STRIPE_WEBHOOK_SECRET; if(!sig||!wh) return NextResponse.json({ok:false},{status:400}); const buf=Buffer.from(await req.arrayBuffer()); try{stripe.webhooks.constructEvent(buf,sig,wh);}catch(e:any){return NextResponse.json({error:`Invalid signature: ${e.message}`},{status:400});} return NextResponse.json({received:true},{status:200}); }